<div class="dashboard-container">
  <h1 class="dashboard-title">Analytics Dashboard</h1>

  <!-- KPI Cards -->
  <div class="kpi-cards">
    <div class="kpi-card">
      <div class="kpi-label">Total Expenses</div>
      <div class="kpi-value">₹{{ totalExpenses().toFixed(2) }}</div>
    </div>
    <div class="kpi-card">
      <div class="kpi-label">Average Expense</div>
      <div class="kpi-value">₹{{ averageExpense().toFixed(2) }}</div>
    </div>
    <div class="kpi-card" *ngIf="topCategory()">
      <div class="kpi-label">Top Category</div>
      <div class="kpi-value">{{ topCategory()!.name }}</div>
      <div class="kpi-subtext">₹{{ topCategory()!.total.toFixed(2) }}</div>
    </div>
  </div>

  <!-- Controls - PRIMARY FILTER -->
  <div class="controls-section">
    <div class="control-group">
      <label id="viewLabel">View:</label>
      <div class="button-group" role="radiogroup" aria-labelledby="viewLabel">
        <button
          class="toggle-btn"
          role="radio"
          [attr.aria-checked]="viewMode() === 'month'"
          [class.active]="viewMode() === 'month'"
          (click)="onViewModeChange('month')"
        >
          Monthly
        </button>
        <button
          class="toggle-btn"
          role="radio"
          [attr.aria-checked]="viewMode() === 'year'"
          [class.active]="viewMode() === 'year'"
          (click)="onViewModeChange('year')"
        >
          Yearly
        </button>
      </div>
    </div>

    <div class="control-group">
      <label for="yearSelect">Year:</label>
      <select id="yearSelect" [ngModel]="selectedYear()" (ngModelChange)="onYearChange($event)">
        <option *ngFor="let year of getAvailableYears()" [ngValue]="year">{{ year }}</option>
      </select>
    </div>

    <div class="control-group" *ngIf="viewMode() === 'month'">
      <label for="monthSelect">Month:</label>
      <select id="monthSelect" [ngModel]="selectedMonth()" (ngModelChange)="onMonthChange($event)">
        <option *ngFor="let month of [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11]; let i = index" [ngValue]="month">
          {{ getMonthName(month) }}
        </option>
      </select>
    </div>
  </div>

  <!-- Charts Grid - Compact Layout -->
  <div class="charts-grid">
    <!-- Monthly Chart - Only show in YEAR view -->
    <div class="chart-container" *ngIf="viewMode() === 'year'">
      <h3 class="chart-title">Monthly Expenses - {{ selectedYear() }}</h3>
      <canvas #monthlyChart class="chart"></canvas>
    </div>

    <!-- Daily Chart - Only show in MONTH view -->
    <div class="chart-container" *ngIf="viewMode() === 'month'">
      <h3 class="chart-title">Daily Expenses - {{ getMonthName(selectedMonth()) }}</h3>
      <canvas #dailyChart class="chart"></canvas>
    </div>

    <!-- Category Chart - Always show -->
    <div class="chart-container">
      <h3 class="chart-title">Category Breakdown</h3>
      <canvas #categoryChart class="chart"></canvas>
    </div>
  </div>

  <!-- Category Breakdown Table - Compact -->
  <div class="category-breakdown">
    <h2 class="section-title">Category Details</h2>
    <div class="breakdown-table">
      <div class="breakdown-header">
        <div class="col-name">Category</div>
        <div class="col-amount">Amount</div>
        <div class="col-percentage">%</div>
      </div>
      <div class="breakdown-row" *ngFor="let cat of categoryDataFiltered()">
        <div class="col-name">
          <span class="color-dot" [style.background-color]="cat.color"></span>
          {{ cat.name }}
        </div>
        <div class="col-amount">₹{{ cat.total.toFixed(2) }}</div>
        <div class="col-percentage">
          <div class="percentage-bar">
            <div class="percentage-fill" [style.width.%]="cat.percentage" [style.background-color]="cat.color"></div>
          </div>
          <span class="percentage-text">{{ cat.percentage }}%</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Top Transactions -->
  <div class="top-transactions-section">
    <h2 class="section-title">Top 5 Transactions</h2>
    <div class="transactions-list">
      <div class="transaction-item" *ngFor="let txn of topTransactions()">
        <div class="transaction-info">
          <div class="transaction-category">{{ getCategoryName(txn.categoryId) }}</div>
          <div class="transaction-date">{{ (txn.date | date:'MMM d, y') }}</div>
        </div>
        <div class="transaction-amount">₹{{ txn.amount.toFixed(2) }}</div>
      </div>
      <div class="no-transactions" *ngIf="topTransactions().length === 0">
        No transactions in selected period
      </div>
    </div>
  </div>
</div>
